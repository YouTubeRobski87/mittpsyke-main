---
layout: layouts/base.njk
title: Logga in
permalink: /login/
disableFooter: true
---

{% block headExtra %}
  <style>
    .login-shell {
      max-width: 520px;
      margin: 0 auto;
      padding: var(--space-2xl) var(--space-lg);
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 18px;
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.25);
      backdrop-filter: blur(8px);
    }
    .login-title {
      text-align: center;
      margin-bottom: var(--space-sm);
      font-size: 1.75rem;
    }
    .login-lede {
      text-align: center;
      margin-bottom: var(--space-xl);
      color: var(--muted);
      line-height: 1.6;
    }
    .login-actions {
      display: grid;
      gap: var(--space-sm);
      margin-top: var(--space-lg);
    }
    .login-input {
      display: grid;
      gap: 6px;
      margin-top: var(--space-md);
    }
    .login-input label {
      color: var(--muted);
      font-size: 0.95rem;
    }
    .login-input input {
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.04);
      color: var(--on-surface, #f7f7ff);
    }
    .login-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.06);
      color: var(--on-surface, #f7f7ff);
      text-decoration: none;
      font-weight: 600;
      transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
    }
    .login-btn:hover {
      transform: translateY(-1px);
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(255, 255, 255, 0.16);
    }
    .login-btn.secondary {
      background: transparent;
      border-color: rgba(255, 255, 255, 0.10);
      color: var(--muted);
    }
    .login-note {
      margin-top: var(--space-lg);
      color: var(--muted);
      text-align: center;
      line-height: 1.5;
    }
    .login-footnote {
      margin-top: var(--space-sm);
      text-align: center;
      color: var(--muted);
      font-size: 0.95rem;
    }
    .login-hint {
      margin-top: 4px;
      color: var(--muted);
      font-size: 0.95rem;
    }
  </style>
{% endblock %}

<main class="container" style="padding: var(--space-3xl) 0;">
  <div class="login-shell">
    <h1 class="login-title">Spara dina samtal (valfritt)</h1>
    <p class="login-lede">
      Om du vill kan du logga in f&ouml;r att forts&auml;tta AI-st&ouml;det &ouml;ver tid.
      Du kan ocks&aring; anv&auml;nda AI-st&ouml;det utan konto.
    </p>

    <div class="login-input">
      <label for="login-email">E-post</label>
      <input id="login-email" type="email" name="email" placeholder="din@epost.se" data-email-input />
      <p class="login-hint">Fyll i e-post och v&auml;lj Google eller E-postl&auml;nk f&ouml;r att forts&auml;tta.</p>
    </div>

    <div class="login-actions">
      <a class="login-btn" href="#" data-login-action="google">
        <span>Forts&auml;tt med Google</span>
      </a>
      <a class="login-btn secondary" href="#" data-login-action="magic">
        <span>F&aring; l&auml;nk via e-post (magic link)</span>
      </a>
    </div>

    <p class="login-note">
      Inloggning g&ouml;r att AI-st&ouml;det kan minnas vad ni pratat om.
      Du best&auml;mmer alltid sj&auml;lv vad som sparas.
    </p>

    <p class="login-footnote">Kom ih&aring;g: AI-st&ouml;det fungerar &auml;ven utan inloggning.</p>
  </div>
</main>

{% block scripts %}
  <script>
    (function () {
      var googleBtn = document.querySelector('[data-login-action="google"]');
      var magicBtn = document.querySelector('[data-login-action="magic"]');
      var emailInput = document.querySelector('[data-email-input]');
      var busy = false;

      function setButtonsEnabled(enabled) {
        busy = !enabled;
        [googleBtn, magicBtn].forEach(function (btn) {
          if (!btn) return;
          btn.style.pointerEvents = enabled ? '' : 'none';
          btn.style.opacity = enabled ? '1' : '0.6';
        });
      }

      setButtonsEnabled(false);

      var ready = window.mpSupabaseReady || Promise.resolve(window.mpSupabase);
      ready
        .then(function (client) {
          if (!client) {
            console.error('Supabase-klient saknas.');
            setButtonsEnabled(true);
            return;
          }

          setButtonsEnabled(true);

          function redirectIfLogged() {
            client.auth.getSession().then(function (res) {
              if (res && res.data && res.data.session) {
                window.location.href = '/ai/';
              }
            });
          }

          redirectIfLogged();

          client.auth.onAuthStateChange(function (event, session) {
            if (event === 'SIGNED_IN' && session) {
              window.location.href = '/ai/';
            }
          });

          function handleMagicLink() {
            if (busy) return;
            var email = emailInput ? emailInput.value.trim() : '';
            if (!email) {
              alert('Ange en e-postadress f&ouml;rst.');
              return;
            }
            setButtonsEnabled(false);
            client.auth
              .signInWithOtp({ email: email })
              .then(function (res) {
                if (res.error) {
                  alert('Kunde inte skicka l&auml;nk: ' + res.error.message);
                  return;
                }
                alert('Kolla din e-post f&ouml;r en magisk l&auml;nk.');
              })
              .catch(function (err) {
                console.error('magic link error', err);
                alert('Kunde inte skicka l&auml;nk: ' + err.message);
              })
              .finally(function () {
                setButtonsEnabled(true);
              });
          }

          function handleGoogle() {
            if (busy) return;
            setButtonsEnabled(false);
            client.auth
              .signInWithOAuth({
                provider: 'google',
                options: { redirectTo: window.location.origin + '/ai/' }
              })
              .then(function (res) {
                if (res.error) {
                  alert('Kunde inte logga in: ' + res.error.message);
                  return;
                }
                if (res.data && res.data.url) {
                  window.location.href = res.data.url;
                } else {
                  alert('Kunde inte starta Google-inloggning (saknar redirect-URL).');
                }
              })
              .catch(function (err) {
                console.error('Google OAuth-fel', err);
                alert('Kunde inte logga in: ' + err.message);
              })
              .finally(function () {
                setButtonsEnabled(true);
              });
          }

          if (googleBtn) googleBtn.addEventListener('click', function (e) { e.preventDefault(); handleGoogle(); });
          if (magicBtn) magicBtn.addEventListener('click', function (e) { e.preventDefault(); handleMagicLink(); });
        })
        .catch(function (err) {
          console.error('Supabase-klient saknas.', err);
          setButtonsEnabled(true);
        });
    })();
  </script>
{% endblock %}
